<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- iPhone-optimized viewport settings -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover, shrink-to-fit=no">
    
    <!-- iPhone-specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Door">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Enhanced iPhone touch icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/door-icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/images/door-icon-152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/images/door-icon-120.png">
    
    <title>Door</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://images.unsplash.com">
    <link rel="dns-prefetch" href="https://images.unsplash.com">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Quote Responses Styling - iPhone Enhanced -->
    <style>
        .quote-responses {
            position: fixed !important;
            /* iPhone home indicator positioning */
            bottom: max(40px, calc(env(safe-area-inset-bottom) + 30px)) !important;
            left: max(20px, calc(env(safe-area-inset-left) + 15px)) !important;
            right: max(20px, calc(env(safe-area-inset-right) + 15px)) !important;
            background: #000000 !important;
            color: #ffffff !important;
            padding: 25px !important;
            border-radius: 16px !important;
            border: 2px solid #ffffff !important;
            text-align: center !important;
            font-size: 18px !important;
            line-height: 1.5 !important;
            display: none !important;
            z-index: 99999 !important;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3) !important;
            font-family: 'Georgia', serif !important;
            margin: 0 auto !important;
            max-width: 600px !important;
            backdrop-filter: blur(15px) !important;
        }
        
        .quote-responses.show {
            display: block !important;
            animation: quoteFadeIn 0.5s ease-out !important;
        }
        
        @keyframes quoteFadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .quote-text {
            font-style: italic !important;
            font-weight: normal !important;
            margin: 0 !important;
            padding: 0 !important;
            color: #ffffff !important;
            font-size: 18px !important;
            line-height: 1.5 !important;
        }
        
        /* DEBUG PANEL STYLING */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 999998;
            max-width: 300px;
            border: 2px solid #00ff00;
            display: none;
        }
        
        .debug-panel.active {
            display: block;
        }
        
        .debug-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ff0000;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            z-index: 999999;
            touch-action: manipulation;
        }
        
        .test-buttons {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 999997;
            display: none;
        }
        
        .test-buttons.active {
            display: flex;
        }
        
        .test-btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
            touch-action: manipulation;
        }
        
        .test-btn:active {
            transform: scale(0.95);
        }
    </style>
    
    <!-- Enhanced Background Audio for iPhone -->
    <audio id="backgroundAudio" 
           loop 
           preload="auto" 
           autoplay 
           muted 
           playsinline 
           webkit-playsinline="true"
           x-webkit-airplay="deny">
        <source src="assets/audio/QUIETSTORM.mp3" type="audio/mpeg">
        <source src="assets/audio/QUIETSTORM.ogg" type="audio/ogg">
        <source src="assets/audio/QUIETSTORM.wav" type="audio/wav">
        <!-- Enhanced fallback for iPhone -->
        Your browser does not support the audio element.
    </audio>
    
    <!-- SEO and iPhone-optimized Meta Tags -->
    <meta name="description" content="Door - An intimate dining experience where every meal becomes a memory. Discover our elegant atmosphere and culinary artistry.">
    <meta name="keywords" content="restaurant, fine dining, Door, culinary experience, intimate dining">
    <meta name="author" content="Door">
    
    <!-- iPhone-specific Open Graph tags -->
    <meta property="og:title" content="Door Restaurant">
    <meta property="og:description" content="An intimate dining experience where every meal becomes a memory">
    <meta property="og:image" content="assets/images/door-og-image.jpg">
    <meta property="og:url" content="https://doorrestaurant.com">
    <meta property="og:type" content="restaurant">
    
    <!-- iPhone Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Door Restaurant">
    <meta name="twitter:description" content="An intimate dining experience where every meal becomes a memory">
    <meta name="twitter:image" content="assets/images/door-twitter-card.jpg">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- DEBUG PANEL -->
    <div class="debug-panel" id="debugPanel">
        <div id="debugInfo">Loading device info...</div>
        <div style="margin-top: 10px;">
            <div>Console: <span id="consoleOutput"></span></div>
        </div>
    </div>
    
    <!-- DEBUG TOGGLE BUTTON -->
    <button class="debug-toggle" onclick="toggleDebug()" title="Toggle Debug Panel">DEBUG</button>
    
    <!-- TEST BUTTONS -->
    <div class="test-buttons" id="testButtons">
        <button class="test-btn" onclick="testMobileQuote()">Test Quote</button>
        <button class="test-btn" onclick="testAccessGranted()">Test Access</button>
        <button class="test-btn" onclick="testBasicMessage()">Test Basic</button>
        <button class="test-btn" onclick="simulateWrongDoor()">Wrong Door</button>
        <button class="test-btn" onclick="simulate3Attempts()">3 Attempts</button>
        <button class="test-btn" onclick="checkElements()">Check DOM</button>
    </div>

    <!-- DOOR PLUGIN SPLASH PAGE WITH EMBOSSED D-O-O-R LETTERS -->
    <div class="splash-page" id="splashPage" role="banner" aria-label="Welcome to Door">
        <!-- Door Gallery with EMBOSSED D-O-O-R letter images -->
        <ul class="door-gallery door-gallery-raised" role="presentation" aria-hidden="true">
            <li>
                <a href="#" 
                   data-door="0" 
                   tabindex="-1" 
                   aria-hidden="true"
                   role="button"
                   aria-label="Door D - Click when highlighted">
                    <div class="letter-container">
                        <span>D</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#" 
                   data-door="1" 
                   tabindex="-1" 
                   aria-hidden="true"
                   role="button"
                   aria-label="Door O - Click when highlighted">
                    <div class="letter-container">
                        <span>O</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#" 
                   data-door="2" 
                   tabindex="-1" 
                   aria-hidden="true"
                   role="button"
                   aria-label="Door O - Click when highlighted">
                    <div class="letter-container">
                        <span>O</span>
                    </div>
                </a>
            </li>
            <li>
                <a href="#" 
                   data-door="3" 
                   tabindex="-1" 
                   aria-hidden="true"
                   role="button"
                   aria-label="Door R - Click when highlighted">
                    <div class="letter-container">
                        <span>R</span>
                    </div>
                </a>
            </li>
        </ul>
        
        <!-- Status Message for Door Entry -->
        <div class="status-message" 
             id="statusMessage" 
             role="status" 
             aria-live="polite">
            Welcome
        </div>
        
        <!-- Enhanced audio toggle for splash page -->
        <button class="splash-audio-toggle" 
                onclick="toggleAudio(event)" 
                data-mobile-hint="Tap to start music"
                title="Play Background Music" 
                id="splashAudioToggle"
                aria-label="Play background music"
                type="button">♪</button>
    </div>

    <!-- MAIN SITE -->
    <div class="main-site" id="mainSite" role="main">
        <!-- iPhone-Optimized Navigation -->
        <nav class="nav" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <a href="index.html" 
                   class="nav-logo" 
                   aria-label="Door Home"
                   role="button">DOOR64</a>
                
                <!-- Enhanced mobile hamburger menu button for iPhone -->
                <button class="mobile-menu" 
                        onclick="toggleMobileMenu()" 
                        aria-label="Toggle mobile menu"
                        aria-expanded="false"
                        aria-controls="navLinks"
                        type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <!-- Enhanced Navigation links for iPhone -->
                <ul class="nav-links" id="navLinks" role="menubar">
                    <li role="none">
                        <a href="space.html" 
                           role="menuitem" 
                           aria-label="Space section">space</a>
                    </li>
                    <li role="none">
                        <a href="in.the.kitchen.html" 
                           role="menuitem" 
                           aria-label="Kitchen section">in the kitchen</a>
                    </li>
                    <li role="none">
                        <a href="at.the.bar.html" 
                           role="menuitem" 
                           aria-label="Bar section">at the bar</a>
                    </li>
                    <li role="none">
                        <a href="who.was.here.html" 
                           role="menuitem" 
                           aria-label="Guest section">who was here</a>
                    </li>
                    <li role="none">
                        <a href="what.to.do.html" 
                           role="menuitem" 
                           aria-label="Events section">what to do</a>
                    </li>
                    <li role="none">
                        <a href="come.see.us.html" 
                           role="menuitem" 
                           aria-label="Reservations">come see us</a>
                    </li>
                    <li role="none">
                        <a href="hit.us.up.html" 
                           role="menuitem" 
                           aria-label="Contact">hit us up</a>
                    </li>
                </ul>
                
                <!-- Enhanced Audio toggle button for iPhone -->
                <div class="nav-left-section">
                    <button class="audio-toggle" 
                            onclick="toggleAudio(event)" 
                            title="Play Background Music"
                            aria-label="Play background music"
                            type="button">♪</button>
                </div>
            </div>
        </nav>

        <!-- Landing Page -->
        <main class="landing-page section active" id="main-content">
            <div class="gallery-slider" role="presentation" aria-hidden="true"></div>
            
            <div class="landing-content">
                <a href="64.html" 
                   style="text-decoration: none;" 
                   aria-label="Door main page"
                   role="button">
                    <h1 class="embossed-logo" style="cursor: pointer;">DOOR64</h1>
                </a>
                
                <div class="landing-links">
                    <div class="landing-link" role="region" aria-label="Space section">
                        <h3>space</h3>
                        <div class="sub-links">
                            <a href="in.the.kitchen.html" 
                               aria-label="Kitchen dining area">in the kitchen</a>
                            <a href="at.the.bar.html" 
                               aria-label="Bar area">at the bar</a>
                        </div>
                    </div>
                    
                    <div class="landing-link" role="region" aria-label="Activities section">
                        <h3>what to do</h3>
                        <div class="sub-links">
                            <a href="come.see.us.html" 
                               aria-label="Make a reservation">make reservation</a>
                            <a href="what.to.do.html" 
                               aria-label="View upcoming events">upcoming events</a>
                        </div>
                    </div>
                    
                    <div class="landing-link" role="region" aria-label="Connect section">
                        <h3>connect</h3>
                        <div class="sub-links">
                            <a href="who.was.here.html" 
                               aria-label="See guest experiences">who was here</a>
                            <a href="come.see.us.html" 
                               aria-label="Visit us">come see us</a>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Landing Gallery for iPhone -->
                <section class="css-gallery" 
                         id="landing-gallery" 
                         role="region" 
                         aria-label="Restaurant showcase gallery"
                         aria-live="polite">
                    <div class="gallery-container">
                        <div class="gallery-track" id="landing-track" role="presentation">
                            <div class="gallery-slide" 
                                 style="background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=800&h=400&fit=crop&auto=format&q=80')"
                                 role="img"
                                 aria-label="Intimate dining experience">
                                <div class="gallery-content">
                                    <h3>intimate dining experience</h3>
                                    <p>where every meal becomes a memory</p>
                                </div>
                            </div>
                            <div class="gallery-slide" 
                                 style="background-image: url('https://images.unsplash.com/photo-1551024506-0bccd828d307?w=800&h=400&fit=crop&auto=format&q=80')"
                                 role="img"
                                 aria-label="Craft cocktails">
                                <div class="gallery-content">
                                    <h3>craft cocktails</h3>
                                    <p>handcrafted with passion and precision</p>
                                </div>
                            </div>
                            <div class="gallery-slide" 
                                 style="background-image: url('https://images.unsplash.com/photo-1424847651672-bf20a4b0982b?w=800&h=400&fit=crop&auto=format&q=80')"
                                 role="img"
                                 aria-label="Culinary artistry">
                                <div class="gallery-content">
                                    <h3>culinary artistry</h3>
                                    <p>seasonal ingredients, chef's creativity</p>
                                </div>
                            </div>
                            <div class="gallery-slide" 
                                 style="background-image: url('https://images.unsplash.com/photo-1559339352-11d035aa65de?w=800&h=400&fit=crop&auto=format&q=80')"
                                 role="img"
                                 aria-label="Wine selection">
                                <div class="gallery-content">
                                    <h3>wine selection</h3>
                                    <p>curated collection of exceptional wines</p>
                                </div>
                            </div>
                            <div class="gallery-slide" 
                                 style="background-image: url('https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&h=400&fit=crop&auto=format&q=80')"
                                 role="img"
                                 aria-label="Elegant atmosphere">
                                <div class="gallery-content">
                                    <h3>elegant atmosphere</h3>
                                    <p>designed for unforgettable experiences</p>
                                </div>
                            </div>
                        </div>
                        
                        <button class="gallery-nav prev" 
                                onclick="previousSlide()" 
                                aria-label="Previous image"
                                title="Previous"
                                type="button">‹</button>
                        <button class="gallery-nav next" 
                                onclick="nextSlide()" 
                                aria-label="Next image"
                                title="Next"
                                type="button">›</button>
                        
                        <div class="gallery-dots" role="tablist" aria-label="Gallery navigation">
                            <button class="gallery-dot active" 
                                    onclick="goToSlide(0)" 
                                    role="tab"
                                    aria-label="Go to slide 1"
                                    aria-selected="true"
                                    tabindex="0"
                                    type="button"></button>
                            <button class="gallery-dot" 
                                    onclick="goToSlide(1)" 
                                    role="tab"
                                    aria-label="Go to slide 2"
                                    aria-selected="false"
                                    tabindex="-1"
                                    type="button"></button>
                            <button class="gallery-dot" 
                                    onclick="goToSlide(2)" 
                                    role="tab"
                                    aria-label="Go to slide 3"
                                    aria-selected="false"
                                    tabindex="-1"
                                    type="button"></button>
                            <button class="gallery-dot" 
                                    onclick="goToSlide(3)" 
                                    role="tab"
                                    aria-label="Go to slide 4"
                                    aria-selected="false"
                                    tabindex="-1"
                                    type="button"></button>
                            <button class="gallery-dot" 
                                    onclick="goToSlide(4)" 
                                    role="tab"
                                    aria-label="Go to slide 5"
                                    aria-selected="false"
                                    tabindex="-1"
                                    type="button"></button>
                        </div>
                        
                        <div class="gallery-progress" 
                             role="progressbar" 
                             aria-label="Gallery progress" 
                             aria-hidden="true"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Quote Responses Section at Bottom (visible on splash page) -->
    <div class="quote-responses" 
         id="quoteResponses" 
         role="status" 
         aria-live="polite" 
         aria-atomic="true">
        <div class="quote-text" id="quoteText"></div>
    </div>

    <!-- Enhanced JavaScript for iPhone -->
    <script src="assets/js/script.js"></script>
    
    <!-- DEBUG TESTING FUNCTIONS -->
    <script>
        // Debug state
        let debugActive = false;
        let consoleLog = [];
        
        // Mobile detection functions
        function detectMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   ('ontouchstart' in window) ||
                   (navigator.maxTouchPoints > 0);
        }
        
        function detectIPhone() {
            return /iPhone|iPod/.test(navigator.userAgent) || 
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }
        
        // Override console.log to capture output
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            consoleLog.push(args.join(' '));
            if (consoleLog.length > 20) consoleLog = consoleLog.slice(-20);
            updateDebugInfo();
        };
        
        // Toggle debug panel
        function toggleDebug() {
            debugActive = !debugActive;
            document.getElementById('debugPanel').classList.toggle('active', debugActive);
            document.getElementById('testButtons').classList.toggle('active', debugActive);
            updateDebugInfo();
        }
        
        // Update debug information
        function updateDebugInfo() {
            const info = document.getElementById('debugInfo');
            const consoleOutput = document.getElementById('consoleOutput');
            
            if (!info) return;
            
            const isMobile = detectMobile();
            const isIPhone = detectIPhone();
            
            info.innerHTML = `
                <strong>Device:</strong> ${isIPhone ? 'iPhone' : (isMobile ? 'Mobile' : 'Desktop')}<br>
                <strong>UA:</strong> ${navigator.userAgent.substring(0, 50)}...<br>
                <strong>Touch:</strong> ${'ontouchstart' in window}<br>
                <strong>Points:</strong> ${navigator.maxTouchPoints}<br>
                <strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}<br>
                <strong>DPR:</strong> ${window.devicePixelRatio}<br>
                <strong>Door Entry:</strong> ${window.rotatingDoorEntry ? 'Loaded' : 'Missing'}<br>
                <strong>Active Door:</strong> ${window.rotatingDoorEntry?.currentActiveIndex ?? 'N/A'}<br>
                <strong>Attempts:</strong> ${window.rotatingDoorEntry?.attemptCount ?? 0}
            `;
            
            if (consoleOutput) {
                consoleOutput.innerHTML = consoleLog.slice(-3).join('<br>');
            }
        }
        
        // Test mobile message (exact replica of Door code)
        function showTestMobileMessage(message, color = '#000000') {
            console.log('🧪 Testing mobile message:', message);
            
            // Remove existing test messages
            document.querySelectorAll('.test-mobile-message').forEach(el => el.remove());
            
            const mobileMessage = document.createElement('div');
            mobileMessage.className = 'test-mobile-message';
            mobileMessage.textContent = message;
            
            // Use exact styling from Door code
            mobileMessage.style.cssText = `
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                z-index: 2147483647 !important;
                background: ${color} !important;
                color: #ffffff !important;
                padding: 30px 35px !important;
                border-radius: 16px !important;
                font-size: 20px !important;
                font-family: Georgia, serif !important;
                font-weight: 600 !important;
                line-height: 1.4 !important;
                text-align: center !important;
                max-width: 85vw !important;
                min-width: 280px !important;
                min-height: 60px !important;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8) !important;
                border: 3px solid #ffffff !important;
                backdrop-filter: blur(20px) !important;
                -webkit-backdrop-filter: blur(20px) !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
                isolation: isolate !important;
                contain: none !important;
                overflow: visible !important;
            `;
            
            // Try different parent elements
            const splashPage = document.getElementById('splashPage');
            let targetParent;
            
            if (splashPage && splashPage.style.display !== 'none') {
                targetParent = splashPage;
                console.log('📍 Appending to splash page');
            } else {
                targetParent = document.body;
                console.log('📍 Appending to body');
            }
            
            targetParent.appendChild(mobileMessage);
            console.log('✅ Message element added');
            
            // Force reflow
            mobileMessage.offsetHeight;
            
            // Check if visible after 100ms
            setTimeout(() => {
                const rect = mobileMessage.getBoundingClientRect();
                const computed = window.getComputedStyle(mobileMessage);
                
                console.log('📊 Message visibility check:', {
                    parentNode: !!mobileMessage.parentNode,
                    rect: `${rect.width}x${rect.height} at ${rect.left},${rect.top}`,
                    computed: {
                        display: computed.display,
                        opacity: computed.opacity,
                        visibility: computed.visibility,
                        zIndex: computed.zIndex,
                        position: computed.position,
                        transform: computed.transform
                    },
                    isVisible: rect.width > 0 && rect.height > 0 && computed.opacity !== '0'
                });
            }, 100);
            
            // Auto-remove
            setTimeout(() => {
                if (mobileMessage.parentNode) {
                    mobileMessage.style.opacity = '0';
                    mobileMessage.style.transition = 'opacity 0.4s ease';
                    setTimeout(() => {
                        if (mobileMessage.parentNode) {
                            mobileMessage.remove();
                            console.log('🗑️ Test message removed');
                        }
                    }, 400);
                }
            }, 4000);
        }
        
        // Test functions
        function testMobileQuote() {
            const quotes = [
                "I'm not locked out, I'm just testing the security system... unsuccessfully.",
                "Door is locked, but so is my motivation to find the right key.",
                "My door is very security-conscious. It doesn't even trust me, and I pay the rent!"
            ];
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            showTestMobileMessage(randomQuote, '#000000');
        }
        
        function testAccessGranted() {
            showTestMobileMessage('ACCESS GRANTED', '#008000');
        }
        
        function testBasicMessage() {
            showTestMobileMessage('BASIC TEST MESSAGE', '#0066cc');
        }
        
        // Simulate actual Door interactions
        function simulateWrongDoor() {
            console.log('🚪 Simulating wrong door click...');
            if (window.rotatingDoorEntry) {
                // Force mobile mode and show quote
                const originalIsMobile = window.rotatingDoorEntry.isMobile;
                window.rotatingDoorEntry.isMobile = true;
                window.rotatingDoorEntry.attemptCount = 1;
                window.rotatingDoorEntry.showRandomQuote();
                // Restore original state
                setTimeout(() => {
                    window.rotatingDoorEntry.isMobile = originalIsMobile;
                }, 100);
            } else {
                console.error('❌ rotatingDoorEntry not found!');
                testMobileQuote();
            }
        }
        
        function simulate3Attempts() {
            console.log('🚪 Simulating 3rd attempt (auto access)...');
            if (window.rotatingDoorEntry) {
                const originalIsMobile = window.rotatingDoorEntry.isMobile;
                window.rotatingDoorEntry.isMobile = true;
                window.rotatingDoorEntry.attemptCount = 3;
                window.rotatingDoorEntry.showAccessGranted();
                setTimeout(() => {
                    window.rotatingDoorEntry.isMobile = originalIsMobile;
                    window.rotatingDoorEntry.attemptCount = 0;
                }, 100);
            } else {
                console.error('❌ rotatingDoorEntry not found!');
                testAccessGranted();
            }
        }
        
        function checkElements() {
            const elements = {
                splashPage: document.getElementById('splashPage'),
                statusMessage: document.getElementById('statusMessage'),
                mobileMessage: document.getElementById('mobileStatusMessage'),
                quoteResponses: document.getElementById('quoteResponses'),
                body: document.body
            };
            
            console.log('🔍 DOM Element Check:', elements);
            
            Object.entries elements).forEach(([key, element]) => {
                if (element) {
                    const styles = window.getComputedStyle(element);
                    const rect = element.getBoundingClientRect();
                    console.log(`📋 ${key}:`, {
                        exists: true,
                        rect: `${rect.width}x${rect.height} at ${rect.left},${rect.top}`,
                        display: styles.display,
                        position: styles.position,
                        zIndex: styles.zIndex,
                        visibility: styles.visibility,
                        opacity: styles.opacity,
                        overflow: styles.overflow
                    });
                } else {
                    console.log(`❌ ${key}: Element not found`);
                }
            });
            
            // Check for high z-index conflicts
            const allElements = document.querySelectorAll('*');
            const highZElements = [];
            
            allElements.forEach(el => {
                const zIndex = parseInt(window.getComputedStyle(el).zIndex);
                if (zIndex > 100000) {
                    highZElements.push({
                        element: el.tagName + (el.id ? '#' + el.id : '') + (el.className ? '.' + el.className.split(' ')[0] : ''),
                        zIndex: zIndex
                    });
                }
            });
            
            console.log('⚡ High z-index elements:', highZElements);
            alert(`Found ${highZElements.length} elements with z-index > 100000`);
        }
        
        // Initialize debug system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Door Debug System Loaded');
            updateDeviceInfo();
            
            // Test detection after Door systems load
            setTimeout(() => {
                updateDebugInfo();
                console.log('🎯 Door systems check:', {
                    doorAudio: !!window.doorAudio,
                    rotatingDoorEntry: !!window.rotatingDoorEntry,
                    mobileMenu: !!window.mobileMenu,
                    doorGalleries: Object.keys(window.doorGalleries || {})
                });
            }, 1000);
        });
        
        // Update debug on resize/orientation change
        window.addEventListener('resize', updateDebugInfo);
        window.addEventListener('orientationchange', () => {
            setTimeout(updateDebugInfo, 100);
        });
        
        // Add global test functions for console use
        window.debugDoor = {
            testMobileMessage: testMobileQuote,
            testAccess: testAccessGranted,
            testBasic: testBasicMessage,
            simulateWrong: simulateWrongDoor,
            simulate3: simulate3Attempts,
            checkDOM: checkElements,
            forceMessage: (msg) => showTestMobileMessage(msg || 'FORCE TEST', '#ff0000'),
            showConsole: () => console.log('Console working!'),
            deviceInfo: () => ({
                isMobile: detectMobile(),
                isIPhone: detectIPhone(),
                userAgent: navigator.userAgent,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                touchSupport: 'ontouchstart' in window,
                maxTouchPoints: navigator.maxTouchPoints
            })
        };
    </script>
    
    <!-- iPhone-specific initialization script -->
    <script>
        // iPhone-specific viewport height handling
        function setIPhoneViewportHeight() {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        // Enhanced iPhone detection
        function isIPhone() {
            return /iPhone|iPod/.test(navigator.userAgent) || 
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }
        
        // iPhone-specific optimizations
        if (isIPhone()) {
            document.body.setAttribute('data-device', 'iphone');
            
            // Enhanced viewport handling for iPhone
            setIPhoneViewportHeight();
            window.addEventListener('resize', setIPhoneViewportHeight);
            window.addEventListener('orientationchange', () => {
                setTimeout(setIPhoneViewportHeight, 100);
            });
            
            // iPhone-specific audio handling
            document.addEventListener('DOMContentLoaded', () => {
                const audio = document.getElementById('backgroundAudio');
                if (audio) {
                    // Enhanced iPhone audio attributes
                    audio.setAttribute('webkit-playsinline', 'true');
                    audio.setAttribute('playsinline', 'true');
                    audio.playsInline = true;
                    audio.load();
                }
            });
            
            // iPhone gesture prevention for door area
            const splashPage = document.getElementById('splashPage');
            if (splashPage) {
                splashPage.addEventListener('touchstart', (e) => {
                    // Allow door clicks but prevent other gestures
                    if (!e.target.closest('.door-gallery a') && !e.target.closest('.splash-audio-toggle')) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }
        
        // Performance monitoring for iPhone
        if ('performance' in window && isIPhone()) {
            window.addEventListener('load', () => {
                const loadTime = Math.round(performance.now());
                console.log(`📱 iPhone optimization - Page loaded in ${loadTime}ms`);
            });
        }
    </script>
</body>
</html>
